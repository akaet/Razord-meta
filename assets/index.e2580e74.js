import{R as e,c as L,f as lt,r as i,p as le,E as ze,a as ct,b as ee,d as me,u as ue,e as Ne,g as J,h as Oe,i as Pe,j as se,k as We,l as Ve,m as Se,n as it,o as de,q as pe,s as ut,t as mt,v as dt,w as pt,x as ft,y as ht,z as Et,A as yt,B as gt,C as xt,D as vt,F as wt,G as Ct,N as bt,O as Nt,H as Pt,I as Ee,J as St,K as At,L as Dt}from"./vendor.5f52fbd4.js";const Lt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}};Lt();function ae(){return navigator.userAgent==="ClashX Runtime"}let $=null;class kt{constructor(t){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(s=>{this.instance=s,t()})}initBridge(t){if(!ae())return t==null?void 0:t(null);if(window.WebViewJavascriptBridge!=null)return t(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(t);window.WVJBCallbacks=[t];const s=document.createElement("iframe");s.style.display="none",s.src="https://__bridge_loaded__",document.documentElement.appendChild(s),setTimeout(()=>document.documentElement.removeChild(s),0)}async callHandler(t,s){return await new Promise(o=>{var a;(a=this.instance)==null||a.callHandler(t,s,o)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(t){return await this.callHandler("setPasteboard",t)}async writeConfigWithString(t){return await this.callHandler("writeConfigWithString",t)}async setSystemProxy(t){return await this.callHandler("setSystemProxy",t)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(t){return await this.callHandler("speedTest",t)}async setStartAtLogin(t){return await this.callHandler("setStartAtLogin",t)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function Ft(n){if($!=null){n();return}$=new kt(n)}function te(n){const{title:t,children:s,className:o,style:a}=n;return e.createElement("header",{className:L("header",o),style:a},e.createElement("h1",{className:"md:text-xl"},t),e.createElement("div",{className:"flex flex-auto items-center justify-end"},s))}function K(n){const{type:t,size:s=14,className:o,style:a}=n,r=L("clash-iconfont",`icon-${t}`,o),l={fontSize:s,...a},c={...n,className:r,style:l};return e.createElement("i",{...c})}function _(){}function Rt(n,t){const s=[],o=[];for(const a of n)t(a)?s.push(a):o.push(a);return[s,o]}function G(n){var o;const t=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(n||1)/Math.log(1024));return`${lt(n/Math.pow(1024,s),2).toFixed(2)} ${(o=t==null?void 0:t[s])!=null?o:""}`}function Ge(n){return n.replace(/.*[/\\]/,"")}function ye(n){const{className:t,checked:s=!1,disabled:o=!1,onChange:a=_}=n,r=L("switch",{checked:s,disabled:o},t);function l(){o||a(!s)}return e.createElement("div",{className:r,onClick:l},e.createElement(K,{className:"switch-icon font-bold",type:"check",size:20}))}const j=i.exports.forwardRef((n,t)=>{const{className:s,style:o,children:a}=n;return e.createElement("div",{className:L("card",s),style:o,ref:t},a)});function $e(n){const{options:t,value:s,onSelect:o}=n;return e.createElement("div",{className:"button-select"},t.map(a=>e.createElement("button",{value:a.value,key:a.value,className:L("button-select-options",{actived:s===a.value}),onClick:()=>o==null?void 0:o(a.value)},a.label)))}var Tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrUlEQVR4nO2YQUrDQBSG41pP0FpBsNWdeJQiFD1BFbSgtxEEt9bSrXgD9Qb1DLVgUpfaT4a+RTNOtGmm00mZDwZKSP73/8PrPJIoCqwRwA7QAZ6AAfApayDXLtU9kW8A28AN8MX/fAMPwG7kA8Cx7HJexkBz1eavgQmLMwGuVrnzJvPPQBvYBzZlqd9nwEtGSzVdm68Z2iYBWnM8eyL36u1UdeN+auJOMxADhzmePzKEuF2u6/RRqZ82rQV0TjUNpVlbjut04Y7e8wvqbACvmtaFfce/C6uBNEu7gNa5pvVo16256JtWtFFA60DTGth1ay6qToxZNgtobWlaY7tuzUVT+Ka3ngGAOtA3nN3LIAG61gabmB/hnqGVELLzq+LeRgAXbZPFh40AKQoLuq5HCJAPQgCNEKCMAZh+ZunJEZzILKmXIgBT86bJPZpnsuJBALXzWXTLECApMlnxIEBc9gD9PwL0yhCgAbxn/In3vA+gUKeNvJTEsnrzmPcmgFf1CAHyQQigEQJ4ECCm5C/13bJ/VqnKRybXDIFK4QASoqJ2w1E7xVLLjvlAYM35AcbS1Q+IFGraAAAAAElFTkSuQmCC",It="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVR4nO2YQUrDQBRAZ+PCKyjaWqkgeA9XXlYE3Wg1LsRDFDeB1EVpodiiFJ5EItS2Yf6MySSj/22yCeS94TOZxBhFUZRWAuwDN8AMuAN6JiaAK37yaGICmKwFLIEdEwvAnE12TSygAf84AOgBA+ADeAZOogkA+kC69tynKALYLv+1AwYPWBmDBZDYxoBy+ZwkaECJzAg49ZBPgeNgARaZV+DM4f6sLLqWAIvMRgR1yfsECOVXx+nCMjZ9b3nXAEd5G9mvVt41QDAG58AwqLw0QDrDwKEgIqtMXhKQb20uMwx0gRfp/SECEleZkoi0cnlhwMJnJYGD4mtvDFwDR5XLCwPug6xkjQHdIuKtuLq/7utEP2iaBg1oGDSgYdCAhuGPBoRmmf8V9zovtSTgmwefgCntYe4TcEl7GPgE7BXn9m3n/lC8A7dAxzlAURTFhOATIybWvlGZEjgAAAAASUVORK5CYII=";const Bt={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow Lan",proxyMode:"Mode",logLevel:"Log Level",redirProxyPort:"Redir proxy port",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller",speedtestUrl:"Speedtest URL",speedtestTimeout:"Speedtest timeout",lowLatency:"Yellow threshold",mediumLatency:"Red threshold"},values:{cn:"\u4E2D\u6587",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version\uFF1A{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs",levelLabel:"Log level",filter:{all:"All"},searchPlaceholder:"Search keywords"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count",searchPlaceholder:"Search keywords"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},searchPlaceholder:"Search keywords",columns:{host:"Host",sniffHost:"Sniff Host",network:"Network",type:"Type",chains:"Chains",process:"Process",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP",destinationIP:"Destination IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"Target",dstIPEmpty:"Empty",srcIP:"Source",upload:"Upload",download:"Download",network:"Network",process:"Process",processPath:"Path",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},$t={SideBar:{Proxies:"\u4EE3\u7406",Overview:"\u603B\u89C8",Logs:"\u65E5\u5FD7",Rules:"\u89C4\u5219",Settings:"\u8BBE\u7F6E",Connections:"\u8FDE\u63A5",Version:"\u7248\u672C"},Settings:{title:"\u8BBE\u7F6E",labels:{startAtLogin:"\u5F00\u673A\u65F6\u542F\u52A8",language:"\u8BED\u8A00",setAsSystemProxy:"\u8BBE\u7F6E\u4E3A\u7CFB\u7EDF\u4EE3\u7406",allowConnectFromLan:"\u5141\u8BB8\u6765\u81EA\u5C40\u57DF\u7F51\u7684\u8FDE\u63A5",proxyMode:"\u4EE3\u7406\u6A21\u5F0F",logLevel:"\u65E5\u5FD7\u7B49\u7EA7",redirProxyPort:"Redir \u4EE3\u7406\u7AEF\u53E3",socks5ProxyPort:"Socks5 \u4EE3\u7406\u7AEF\u53E3",httpProxyPort:"HTTP \u4EE3\u7406\u7AEF\u53E3",mixedProxyPort:"\u6DF7\u5408\u4EE3\u7406\u7AEF\u53E3",externalController:"\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",speedtestUrl:"\u6D4B\u901F\u5730\u5740",speedtestTimeout:"\u6D4B\u901F\u8D85\u65F6",lowLatency:"\u9EC4\u8272\u9608\u503C",mediumLatency:"\u7EA2\u8272\u9608\u503C"},values:{cn:"\u4E2D\u6587",en:"English",global:"\u5168\u5C40",rules:"\u89C4\u5219",direct:"\u76F4\u8FDE",script:"\u811A\u672C"},versionString:"\u5F53\u524D ClashX \u5DF2\u662F\u6700\u65B0\u7248\u672C\uFF1A{{version}}",checkUpdate:"\u68C0\u67E5\u66F4\u65B0",externalControllerSetting:{title:"\u7F16\u8F91\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",note:"\u8BF7\u6CE8\u610F\uFF0C\u4FEE\u6539\u8BE5\u914D\u7F6E\u9879\u5E76\u4E0D\u4F1A\u4FEE\u6539\u4F60\u7684 Clash \u914D\u7F6E\u6587\u4EF6\uFF0C\u8BF7\u786E\u8BA4\u4FEE\u6539\u540E\u7684\u5916\u90E8\u63A7\u5236\u5730\u5740\u548C Clash \u914D\u7F6E\u6587\u4EF6\u5185\u7684\u5730\u5740\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4 Dashboard \u65E0\u6CD5\u8FDE\u63A5\u3002",host:"Host",port:"\u7AEF\u53E3",secret:"\u5BC6\u94A5"}},Logs:{title:"\u65E5\u5FD7",levelLabel:"\u65E5\u5FD7\u7B49\u7EA7",filter:{all:"\u5168\u90E8"},searchPlaceholder:"\u5173\u952E\u8BCD\u641C\u7D22"},Rules:{title:"\u89C4\u5219",providerTitle:"\u89C4\u5219\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",ruleCount:"\u89C4\u5219\u6761\u6570",searchPlaceholder:"\u5173\u952E\u8BCD\u641C\u7D22"},Connections:{title:"\u8FDE\u63A5",keepClosed:"\u4FDD\u7559\u5173\u95ED\u8FDE\u63A5",total:{text:"\u603B\u91CF",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D"},closeAll:{title:"\u8B66\u544A",content:"\u5C06\u4F1A\u5173\u95ED\u6240\u6709\u8FDE\u63A5"},filter:{all:"\u5168\u90E8"},searchPlaceholder:"\u5173\u952E\u8BCD\u641C\u7D22",columns:{host:"\u57DF\u540D",sniffHost:"\u55C5\u63A2\u57DF\u540D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",type:"\u7C7B\u578B",chains:"\u8282\u70B9\u94FE",rule:"\u89C4\u5219",time:"\u8FDE\u63A5\u65F6\u95F4",speed:"\u901F\u7387",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",sourceIP:"\u6765\u6E90 IP",destinationIP:"\u76EE\u6807 IP"},info:{title:"\u8FDE\u63A5\u4FE1\u606F",id:"ID",host:"\u57DF\u540D",hostEmpty:"\u7A7A",dstIP:"\u76EE\u6807 IP",dstIPEmpty:"\u7A7A",srcIP:"\u6765\u6E90",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",processPath:"\u8DEF\u5F84",inbound:"\u5165\u53E3",rule:"\u89C4\u5219",chains:"\u4EE3\u7406",status:"\u72B6\u6001",opening:"\u8FDE\u63A5\u4E2D",closed:"\u5DF2\u5173\u95ED",closeConnection:"\u5173\u95ED\u8FDE\u63A5"}},Proxies:{title:"\u4EE3\u7406",editDialog:{title:"\u7F16\u8F91\u4EE3\u7406",color:"\u989C\u8272",name:"\u540D\u5B57",type:"\u7C7B\u578B",server:"\u670D\u52A1\u5668",port:"\u7AEF\u53E3",password:"\u5BC6\u7801",cipher:"\u52A0\u5BC6\u65B9\u5F0F",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"\u7B56\u7565\u7EC4",providerTitle:"\u4EE3\u7406\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",expandText:"\u5C55\u5F00",collapseText:"\u6536\u8D77",speedTestText:"\u6D4B\u901F",breakConnectionsText:"\u5207\u6362\u65F6\u6253\u65AD\u5305\u542B\u7B56\u7565\u7EC4\u7684\u8FDE\u63A5"},Modal:{ok:"\u786E \u5B9A",cancel:"\u53D6 \u6D88"}},Ye={en_US:Bt,zh_CN:$t},Mt=Object.keys(Ye);function Ut(){for(const n of window.navigator.languages){if(n.includes("zh"))return"zh_CN";if(n.includes("us"))return"en_US"}return"en_US"}function Ae(n){return i.exports.useMemo(()=>{function s(o,a){if(typeof o=="string")n(r=>{const l=o,c=a;r[l]=c});else if(typeof o=="function"){const r=o;n(l=>r(l))}else typeof o=="object"&&n(r=>le(r,l=>{const c=o;for(const m of Object.keys(c)){const d=m;l[d]=c[d]}}))}return s},[n])}class je{constructor(t){this.EE=new ze,this.innerBuffer=[],this.url="",this.connection=null,this.config=Object.assign({bufferLength:0,retryInterval:5e3},t)}connectWebsocket(){const t=new URL(this.url);this.connection=new WebSocket(t.toString()),this.connection.addEventListener("message",s=>{const o=JSON.parse(s.data);this.EE.emit("data",[o]),this.config.bufferLength>0&&(this.innerBuffer.push(o),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),this.connection.addEventListener("error",s=>{var o;this.EE.emit("error",s),(o=this.connection)==null||o.close(),setTimeout(this.connectWebsocket,this.config.retryInterval)})}connect(t){var s;this.url===t&&this.connection||(this.url=t,(s=this.connection)==null||s.close(),this.connectWebsocket())}subscribe(t,s){this.EE.addListener(t,s)}unsubscribe(t,s){this.EE.removeListener(t,s)}buffer(){return this.innerBuffer.slice()}destory(){var t;this.EE.removeAllListeners(),(t=this.connection)==null||t.close(),this.connection=null}}class Ht{constructor(t,s){this.axiosClient=ct.create({baseURL:t,headers:s?{Authorization:`Bearer ${s}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(t){return await this.axiosClient.patch("configs",t)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const t=await this.axiosClient.get("providers/proxies",{validateStatus(s){return s>=200&&s<300||s===404}});return t.status===404&&(t.data={providers:{}}),t}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(t){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(t)}`)}async updateRuleProvider(t){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(t)}`)}async healthCheckProvider(t){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(t)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(t,s,o){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}/delay`,{params:{timeout:o!=null?o:5e3,url:s!=null?s:"https://www.gstatic.com/generate_204"}})}async getGroupDelay(t,s,o){return await this.axiosClient.get(`group/${encodeURIComponent(t)}/delay`,{params:{timeout:o!=null?o:5e3,url:s!=null?s:"https://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(t){return await this.axiosClient.delete(`connections/${t}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(t,s){return await this.axiosClient.put(`proxies/${encodeURIComponent(t)}`,{name:s})}}const zt=ee(async()=>{if(!ae())return null;const n=await $.getAPIInfo();return{hostname:n.host,port:n.port,secret:n.secret,protocol:"http:"}}),Ke=me("externalControllers",[]);function ce(){var d,u,h,f,g,E,w,S,y,x,N,I,B,b,k;const n=ue(zt),t=Ne(),s=ue(Ke);if(n!=null)return n;let o;{const D=document.querySelector('meta[name="external-controller"]');((d=D==null?void 0:D.content)==null?void 0:d.match(/^https?:/))!=null&&(o=new URL(D.content))}const a=new URLSearchParams(t.search),r=(g=(f=(h=a.get("host"))!=null?h:(u=s==null?void 0:s[0])==null?void 0:u.hostname)!=null?f:o==null?void 0:o.hostname)!=null?g:"127.0.0.1",l=(y=(S=(w=a.get("port"))!=null?w:(E=s==null?void 0:s[0])==null?void 0:E.port)!=null?S:o==null?void 0:o.port)!=null?y:"9090",c=(B=(I=(N=a.get("secret"))!=null?N:(x=s==null?void 0:s[0])==null?void 0:x.secret)!=null?I:o==null?void 0:o.username)!=null?B:"",m=((b=a.get("protocol"))!=null?b:r==="127.0.0.1")?"http:":(k=o==null?void 0:o.protocol)!=null?k:window.location.protocol;return{hostname:r,port:l,secret:c,protocol:m}}const Ot=ee({key:"",instance:null});function X(){const{hostname:n,port:t,secret:s,protocol:o}=ce(),[a,r]=J(Ot),l=`${o}//${n}:${t}?secret=${s}`;if(a.key===l)return a.instance;const c=new Ht(`${o}//${n}:${t}`,s);return r({key:l,instance:c}),c}const De=ee(!0),Wt=me("language",void 0);function O(){const[n,t]=J(Wt),s=i.exports.useMemo(()=>n!=null?n:Ut(),[n]),o=i.exports.useCallback(function(a){function r(l){return it(Ye[s][a],l)}return{t:r}},[s]);return{lang:s,locales:Mt,setLang:t,translation:o}}const Je=ee({version:"",premium:!1,meta:!1});function Xe(){const[n,t]=J(Je),s=X(),o=Pe(De);return se([s],async function(){const a=await We.fromPromise(s.getVersion(),r=>r);o(a.isOk()),t(a.isErr()?{version:"",premium:!1,meta:!1}:{version:a.value.data.version,premium:!!a.value.data.premium,meta:!!a.value.data.meta})}),n}function qe(){const[{premium:n,meta:t}]=J(Je),s=X(),{data:o,mutate:a}=se(["/providers/rule",s,n,t],async()=>{if(!n&&!t)return[];const r=await s.getRuleProviders();return Object.keys(r.data.providers).map(l=>r.data.providers[l])});return{providers:o!=null?o:[],update:a}}const Vt=me("profile",{breakConnections:!1,logLevel:""}),Gt=me("speedTestConfig",{speedtestUrl:"https://www.gstatic.com/generate_204",speedtestTimeout:5e3,lowLatency:400,mediumLatency:800});function fe(){const[n,t]=J(Gt);return{config:n,setConfig:t}}function he(){const[n,t]=J(Vt),s=i.exports.useCallback(o=>{t(le(n,o))},[n,t]);return{data:n,set:Ae(s)}}const _e=ee([]);function Le(){const[n,t]=J(_e),s=X(),{data:o,mutate:a}=se(["/providers/proxy",s],async()=>{const r=await s.getProxyProviders();return Object.keys(r.data.providers).map(l=>r.data.providers[l]).filter(l=>l.name!=="default").filter(l=>l.vehicleType!=="Compatible")});return i.exports.useEffect(()=>{t(o!=null?o:[])},[o,t]),{providers:n,update:a}}function ke(){const n=X(),{data:t,mutate:s}=se(["/config",n],async()=>{var r;const a=(await n.getConfig()).data;return{port:a.port,socksPort:a["socks-port"],mixedPort:(r=a["mixed-port"])!=null?r:0,redirPort:a["redir-port"],mode:a.mode.toLowerCase(),logLevel:a["log-level"],allowLan:a["allow-lan"]}});return{general:t!=null?t:{},update:s}}const Qe=Oe({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function ie(){const[n,t]=J(Qe),s=Ae(t),o=X(),{mutate:a}=se(["/proxies",o],async()=>{const l=await o.getProxies(),c=l.data.proxies.GLOBAL;c.name="GLOBAL";const m=new Set(["Selector","URLTest","Fallback","LoadBalance"]),d=new Set(["DIRECT","REJECT","GLOBAL"]),u=c.all.filter(g=>!d.has(g)).map(g=>({...l.data.proxies[g],name:g})),[h,f]=Rt(u,g=>!m.has(g.type));s({proxies:h,groups:f,global:c})}),r=i.exports.useCallback((l,c)=>{s(m=>{l==="GLOBAL"&&(m.global.now=c);for(const d of m.groups)d.name===l&&(d.now=c)})},[s]);return{proxies:n.proxies,groups:n.groups,global:n.global,update:a,markProxySelected:r,set:s}}const Ze=ee(n=>{const t=n(Qe),s=n(_e),o=new Map;for(const a of t.proxies)o.set(a.name,a);for(const a of s)for(const r of a.proxies)o.set(r.name,r);return o});function et(){const{data:n,mutate:t}=se("/clashx",async()=>{var a,r;if(!ae())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const s=(a=await($==null?void 0:$.getStartAtLogin()))!=null?a:!1,o=(r=await($==null?void 0:$.isSystemProxySet()))!=null?r:!1;return{startAtLogin:s,systemProxy:o,isClashX:!0}});return{data:n,update:t}}const Yt=Oe([]);function jt(){const[n,t]=J(Yt),s=Ae(t),o=X();async function a(){const r=await o.getRules();s(r.data.rules)}return{rules:n,update:a}}const Kt=ee(new je({bufferLength:200}));function tt(){const n=ce(),{general:t}=ke(),{data:{logLevel:s}}=he(),o=ue(Kt),a=s||t.logLevel,r=Ve(`${n.protocol}//${n.hostname}:${n.port}/logs?level=${a}&secret=${encodeURIComponent(n.secret)}`),l=Se(n);return i.exports.useEffect(()=>{if(a){const c=l.current,d=`${c.protocol==="http:"?"ws:":"wss:"}//${c.hostname}:${c.port}/logs?level=${a}&token=${encodeURIComponent(c.secret)}`;o.connect(d)}},[l,o,a,r]),o}const Jt=ee(new je({bufferLength:200}));function Xt(){const n=ce(),t=ue(Jt),s=Ve(`${n.protocol}//${n.hostname}:${n.port}/connections?token=${encodeURIComponent(n.secret)}`),o=Se(n);return i.exports.useEffect(()=>{const a=o.current,l=`${a.protocol==="http:"?"ws:":"wss:"}//${a.hostname}:${a.port}/connections?token=${encodeURIComponent(a.secret)}`;t.connect(l)},[o,t,s]),t}function qt({children:n,content:t,className:s,delay:o=0}){const[a,r]=i.exports.useState(!1),[l,c]=i.exports.useState(!1),[m,d]=i.exports.useState({top:0,left:0,place:"top",align:"left"}),u=i.exports.useRef(null),h=i.exports.useRef(null),f=i.exports.useRef(null),g=i.exports.useRef(null),E=y=>{h.current!==null&&(window.clearTimeout(h.current),h.current=null);let x=y.currentTarget,N=x.closest("li");const I=N?N.getBoundingClientRect():x.getBoundingClientRect();g.current=I;const B=I.top<300?"bottom":"top",b={top:B==="top"?I.top:I.bottom,left:I.left,place:B,align:"left"};if(d(b),!(l&&a)){if(l&&!a){r(!0);return}o>0?u.current=window.setTimeout(()=>{c(!0),requestAnimationFrame(()=>r(!0))},o):(c(!0),requestAnimationFrame(()=>r(!0)))}},w=()=>{u.current!==null&&(window.clearTimeout(u.current),u.current=null),r(!1),h.current=window.setTimeout(()=>{c(!1)},300)};i.exports.useLayoutEffect(()=>{!l||!f.current||!g.current||requestAnimationFrame(()=>{if(!f.current||!g.current)return;const y=f.current,x=g.current,N=y.offsetWidth||y.scrollWidth,I=window.innerWidth,k=x.left+N<=I?"left":"right",D=k==="left"?x.left:x.right-N;d(R=>({...R,left:D,align:k}))})},[l,t]),i.exports.useEffect(()=>()=>{u.current!==null&&(window.clearTimeout(u.current),u.current=null),h.current!==null&&(window.clearTimeout(h.current),h.current=null)},[]);const S=l&&de.exports.createPortal(e.createElement("div",{ref:f,className:L("tooltip",{"tooltip-visible":a}),style:{top:m.top,left:m.left,position:"fixed",transform:m.place==="top"?"translateY(-100%) translateY(-8px)":"translateY(8px)"}},e.createElement("div",{className:"tooltip-content-wrapper"},t)),document.body);return e.createElement("div",{className:L("tooltip-container",s),onMouseEnter:E,onMouseLeave:w},n,S)}function _t(n){const{className:t,data:s,onClick:o,select:a,canClick:r,errSet:l,rowHeight:c,fixed:m,group:d}=n,{translation:u}=O(),{t:h}=u("Proxies"),[f,g]=i.exports.useState(!1),[E,w]=i.exports.useState(!1),[S]=J(Ze),{config:y}=fe(),x=i.exports.useRef(null);i.exports.useLayoutEffect(()=>{var D,R;w(((R=(D=x==null?void 0:x.current)==null?void 0:D.offsetHeight)!=null?R:0)>30)},[]);const N=f?"auto":c,I=r?o:_,B=i.exports.useCallback(D=>D===0?"#909399":D<y.lowLatency?"#57b366":D<y.mediumLatency?"#ff9a28":"#ff3e5e",[y.lowLatency,y.mediumLatency]);function b(){g(!f)}const k=s.map(D=>{var W;const M=L(r?"cursor-pointer":"cursor-default",{"tags-selected":a===D,error:l==null?void 0:l.has(D)}),v=(W=S.get(D))==null?void 0:W.history,F=v!=null&&v.length?v.slice(-1)[0].delay:0,U=B(F);return e.createElement("li",{className:M,key:D,onClick:()=>I(D)},D===m&&e.createElement("img",{className:"proxy-fixed",src:Tt,width:11,height:11,alt:""}),D,d.type==="URLTest"&&v&&v.length>0&&e.createElement(qt,{delay:600,content:v.map((Z,q)=>{const re=B(Z.delay);return e.createElement("div",{key:q},pe(Z.time).format("YYYY-MM-DD HH:mm:ss")," ",e.createElement("span",{style:{color:re}},Z.delay,"ms"))})},e.createElement("span",{className:"proxy-delay",style:{color:U}},"\u2003",F===0&&e.createElement("img",{src:It,width:11,height:11,alt:"trend"}),F!==0&&`${F}ms`)),!(d.type==="URLTest"&&v&&v.length>0)&&F!==0&&e.createElement("span",{className:"proxy-delay",style:{color:U}},"\u2003",`${F}ms`))});return e.createElement("div",{className:L("flex items-start overflow-y-hidden",t),style:{height:N}},e.createElement("ul",{ref:x,className:L("tags",{expand:f})},k),E&&e.createElement("span",{className:"h-7 px-5 select-none cursor-pointer leading-7",onClick:b},h(f?"collapseText":"expandText")))}function Y(n){const{className:t,style:s,value:o="",align:a="center",inside:r=!1,autoFocus:l=!1,type:c="text",disabled:m=!1,placeholder:d,onChange:u=_,onBlur:h=_,onFocus:f=_,onEnter:g=_}=n,E=L("input",`text-${a}`,{"focus:shadow-none":r},t);function w(S){S.code==="Enter"&&g(S)}return e.createElement("input",{disabled:m,className:E,style:s,value:o,placeholder:d,autoFocus:l,type:c,onChange:S=>u(S.target.value,S),onBlur:h,onFocus:f,onKeyDown:w})}function ge(n){const{value:t,options:s,onSelect:o,className:a,style:r,maxHeight:l=300}=n,c=i.exports.useRef(document.createElement("div")),m=i.exports.useRef(null),d=i.exports.useRef(null),[u,h]=i.exports.useState(!1),[f,g]=i.exports.useState({});i.exports.useLayoutEffect(()=>{if(!u)return;const y=m.current.getBoundingClientRect(),x=Math.floor(y.left);g({top:Math.floor(y.top+y.height)+6,left:x,minWidth:y.width}),requestAnimationFrame(()=>{if(!d.current||!u)return;const N=d.current.offsetWidth||d.current.scrollWidth,I=window.innerWidth,b=x+N<=I?x:y.right-N;g(k=>({...k,left:Math.max(0,b)}))})},[u]),i.exports.useLayoutEffect(()=>{const y=c.current;return document.body.appendChild(y),()=>{document.body.removeChild(y)}},[]),i.exports.useEffect(()=>{if(!u)return;function y(x){const N=x.target;m.current&&d.current&&!m.current.contains(N)&&!d.current.contains(N)&&h(!1)}return document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[u]);function E(){h(!u)}const w=i.exports.useMemo(()=>s.find(y=>y.value===t),[t,s]),S=e.createElement("div",{ref:d,className:L("select-list",{"select-list-show":u}),style:f},e.createElement("ul",{className:"list",style:{maxHeight:typeof l=="number"?`${l}px`:l}},s.map(y=>{var x;return e.createElement(Qt,{className:L({selected:y.value===t}),onClick:N=>{o==null||o(y.value,N),h(!1)},disabled:y.disabled,key:(x=y.key)!=null?x:y.value,value:y.value},y.label)})));return e.createElement(e.Fragment,null,e.createElement("div",{className:L("select",a),style:r,ref:m,onClick:E},w==null?void 0:w.label,e.createElement(K,{type:"triangle-down"})),de.exports.createPortal(S,c.current))}function Qt(n){const{className:t,style:s,disabled:o=!1,children:a,onClick:r=_}=n,l=L("option",{disabled:o},t);return e.createElement("li",{className:l,style:s,onClick:r},a)}const Zt="search-history",en=10;function Fe(n){const{className:t,style:s,value:o="",placeholder:a="\u641C\u7D22...",onSearch:r,onClear:l,storageKey:c=Zt,maxHistory:m=en,minWidth:d="200px",align:u="right",maxHeight:h=300}=n,[f,g]=i.exports.useState(o),[E,w]=i.exports.useState(!1),[S,y]=i.exports.useState([]),x=i.exports.useRef(null),N=i.exports.useRef(null);i.exports.useEffect(()=>{g(o)},[o]),i.exports.useEffect(()=>{try{const v=localStorage.getItem(c);if(v){const F=JSON.parse(v),U=Array.from(new Set(Array.isArray(F)?F:[]));y(U)}}catch{}},[c]);const I=v=>{try{localStorage.setItem(c,JSON.stringify(v)),y(v)}catch{}},B=v=>{if(!v.trim())return;const F=v.trim(),U=[F,...S.filter(W=>W!==F)].slice(0,m);I(U)},b=v=>{g(v),v.trim()&&B(v.trim()),r==null||r(v),w(!1)},k=v=>{g(v)},D=()=>{g(""),l==null||l(),w(!1)},R=v=>{b(v)},M=(v,F)=>{F.stopPropagation(),F.preventDefault(),N.current!==null&&(window.clearTimeout(N.current),N.current=null);const U=S.filter(W=>W!==v);I(U),f.trim()===v.trim()&&g(""),U.length===0?w(!1):w(!0)};return i.exports.useEffect(()=>{function v(F){x.current&&!x.current.contains(F.target)&&w(!1)}if(E)return document.addEventListener("mousedown",v),()=>{document.removeEventListener("mousedown",v)}},[E]),i.exports.useEffect(()=>()=>{N.current!==null&&window.clearTimeout(N.current)},[]),e.createElement("div",{ref:x,className:L("search-input",t),style:s},e.createElement("div",{className:"search-input-wrapper",style:{minWidth:d}},e.createElement(Y,{className:"search-input-field",value:f,placeholder:a,align:u,onChange:k,onEnter:()=>b(f),onBlur:()=>{N.current=window.setTimeout(()=>{w(!1),N.current=null},200)},onFocus:()=>{N.current!==null&&(window.clearTimeout(N.current),N.current=null),w(!0)}}),f&&e.createElement(K,{type:"close",size:14,className:"search-input-clear",onClick:D})),E&&S.length>0&&e.createElement("div",{className:"search-input-history",style:{maxHeight:typeof h=="number"?`${h}px`:h}},e.createElement("ul",{className:"search-input-history-list"},S.map((v,F)=>e.createElement("li",{key:`${v}-${F}`,className:"search-input-history-item",onClick:()=>R(v)},e.createElement("span",{className:"search-input-history-item-text"},v),e.createElement(K,{type:"close",size:12,className:"search-input-history-item-delete",onClick:U=>M(v,U)}))))))}function nt(n){const{show:t=!0,title:s="Modal",size:o="small",footer:a=!0,onOk:r=_,onClose:l=_,bodyClassName:c,bodyStyle:m,className:d,style:u,children:h}=n,{translation:f}=O(),{t:g}=f("Modal"),E=i.exports.useRef(document.createElement("div")),w=i.exports.useRef(null);i.exports.useLayoutEffect(()=>{const x=E.current;return document.body.appendChild(x),()=>{document.body.removeChild(x)}},[]);function S(x){x.target===w.current&&l()}const y=e.createElement("div",{className:L("modal-mask",{"modal-show":t}),ref:w,onMouseDown:S},e.createElement("div",{className:L("modal",`modal-${o}`,d),style:u},e.createElement("div",{className:"modal-title"},s),e.createElement("div",{className:L("modal-body",c),style:m},h),a&&e.createElement("div",{className:"footer"},e.createElement(xe,{onClick:()=>l()},g("cancel")),e.createElement(xe,{type:"primary",onClick:()=>r()},g("ok")))));return de.exports.createPortal(y,E.current)}const tn={success:"check",info:"info",warning:"info",error:"close"};function nn(n){const{message:t="",type:s="info",inside:o=!1,children:a,className:r,style:l}=n,c=L("alert",`alert-${o?"note":"box"}-${s}`,r);return e.createElement("div",{className:c,style:l},e.createElement("span",{className:"alert-icon"},e.createElement(K,{type:tn[s],size:26})),t?e.createElement("p",{className:"alert-message"},t):e.createElement("div",{className:"alert-message"},a))}function xe(n){const{type:t="normal",onClick:s=_,children:o,className:a,style:r,disiabled:l}=n,c=L("button",`button-${t}`,a,{"button-disabled":l});return e.createElement("button",{className:c,style:r,onClick:s,disabled:l},o)}function Re(n){const[t,s]=ut(n),o=i.exports.useMemo(()=>{function a(r,l){typeof r=="string"?s(c=>{const m=r,d=l;c[m]=d}):typeof r=="function"?s(r):typeof r=="object"&&s(c=>{const m=r;for(const d of Object.keys(m)){const u=d;c[u]=m[u]}})}return a},[s]);return[t,o]}function sn(n,t=0){if(n.length<2)throw new Error("List requires at least two elements");const[s,o]=i.exports.useState(t);function a(){o((s+1)%n.length)}return{current:i.exports.useMemo(()=>n[s],[n,s]),next:a}}function Te(n=!1){const[t,s]=i.exports.useState(n);function o(){s(!1)}function a(){s(!0)}return{visible:t,hide:o,show:a}}function on(){const[n,t]=i.exports.useState(()=>typeof document!="undefined"?document.visibilityState:"visible");return i.exports.useEffect(()=>{const s=()=>{t(document.visibilityState)};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}},[]),n}function st(n){const{className:t,checked:s=!1,onChange:o=_}=n,a=L("checkbox",{checked:s},t);function r(){o(!s)}return e.createElement("div",{className:a,onClick:r},e.createElement(K,{className:"checkbox-icon",type:"check",size:18}),e.createElement("div",null,n.children))}function oe(n){const{color:t,className:s,style:o}=n,a=L("tag",s),r={color:t,...o},l={...n,className:a,style:r};return e.createElement("span",{...l},n.children)}function an(n){const t=L("spinner",n.className);return e.createElement("div",{className:t},e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})))}function ot(n){const t=L("loading","visible",n.className);return n.visible?e.createElement("div",{className:t},e.createElement(an,{className:n.spinnerClassName})):null}function rn(n){var a,r,l;const t=i.exports.useRef(document.createElement("div"));i.exports.useLayoutEffect(()=>{const c=t.current;return document.body.appendChild(c),()=>{document.body.removeChild(c)}},[]);const s="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",o=e.createElement("div",{className:L(n.className,"absolute inset-0 pointer-events-none z-9999")},e.createElement(j,{className:L(s,n.bodyClassName,{"translate-x-0":n.visible}),style:{width:(a=n.width)!=null?a:400}},n.children));return de.exports.createPortal(o,(l=(r=n.containerRef)==null?void 0:r.current)!=null?l:t.current)}var ln="./assets/icon-close-all.bc08d9aa.svg";pe.extend(mt);function Ie(n,t){const s=t==="en_US"?"en":"zh-cn";return pe().locale(s).from(n)}function cn(n){var o,a,r,l,c,m,d,u,h,f,g,E,w;const{translation:t}=O(),s=i.exports.useMemo(()=>t("Connections").t,[t]);return e.createElement("div",{className:L(n.className,"text-xs flex flex-col overflow-y-auto")},e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.id")),e.createElement("span",{className:"font-mono"},n.connection.id)),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.network")),e.createElement("span",{className:"font-mono"},(o=n.connection.metadata)==null?void 0:o.network)),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.inbound")),e.createElement("span",{className:"font-mono"},(a=n.connection.metadata)==null?void 0:a.type))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.host")),e.createElement("span",{className:"font-mono flex-1 break-all"},n.connection.metadata?`${n.connection.metadata.host||n.connection.metadata.destinationIP}:${(r=n.connection.metadata)==null?void 0:r.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.host")),e.createElement("span",{className:"font-mono flex-1 break-all"},n.connection.metadata?`${n.connection.metadata.sniffHost}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.dstIP")),e.createElement("span",{className:"font-mono"},n.connection.metadata?`${((l=n.connection.metadata)==null?void 0:l.remoteDestination)||((c=n.connection.metadata)==null?void 0:c.destinationIP)||((m=n.connection.metadata)==null?void 0:m.host)}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.srcIP")),e.createElement("span",{className:"font-mono"},`${(d=n.connection.metadata)==null?void 0:d.sourceIP}:${(u=n.connection.metadata)==null?void 0:u.sourcePort}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.process")),e.createElement("span",{className:"font-mono"},(h=n.connection.metadata)!=null&&h.processPath?`${Ge(n.connection.metadata.processPath)}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.processPath")),e.createElement("span",{className:"font-mono flex-1 break-all"},(f=n.connection.metadata)!=null&&f.processPath?`${n.connection.metadata.processPath}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.rule")),e.createElement("span",{className:"font-mono"},n.connection.rule&&`${n.connection.rule}${n.connection.rulePayload&&` :: ${n.connection.rulePayload}`}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.chains")),e.createElement("span",{className:"font-mono flex-1 break-all"},(g=n.connection.chains)==null?void 0:g.slice().reverse().join(" / "))),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.upload")),e.createElement("span",{className:"font-mono"},G((E=n.connection.upload)!=null?E:0))),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.download")),e.createElement("span",{className:"font-mono"},G((w=n.connection.download)!=null?w:0)))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.status")),e.createElement("span",{className:"font-mono"},n.connection.completed?e.createElement("span",{className:"text-red"},s("info.closed")):e.createElement("span",{className:"text-green"},s("info.opening")))))}class un{constructor(){this.connections=new Map,this.saveDisconnection=!1,this.listeners=new Set}appendToSet(t){var o;const s=t.reduce((a,r)=>a.set(r.id,r),new Map);for(const a of this.connections.keys())if(!s.has(a))if(!this.saveDisconnection)this.connections.delete(a);else{const r=this.connections.get(a);r!=null&&this.connections.set(a,le(r,l=>{l.completed=!0,l.uploadSpeed=0,l.downloadSpeed=0}))}for(const a of s.keys()){if(!this.connections.has(a)){this.connections.set(a,{...s.get(a),uploadSpeed:0,downloadSpeed:0});continue}const r=this.connections.get(a),l=s.get(a);(o=this.connections)==null||o.set(a,{...l,uploadSpeed:l.upload-r.upload,downloadSpeed:l.download-r.download})}this.notifyListeners()}toggleSave(){var t,s;if(this.saveDisconnection){this.saveDisconnection=!1;for(const o of this.connections.keys())(s=(t=this.connections)==null?void 0:t.get(o))!=null&&s.completed&&this.connections.delete(o)}else this.saveDisconnection=!0;return this.notifyListeners(),this.saveDisconnection}getConnections(){return[...this.connections.values()]}getSaveState(){return this.saveDisconnection}subscribe(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}notifyListeners(){this.listeners.forEach(t=>t())}}const ne=new un;function at(){const[n,t]=i.exports.useState(ne.getConnections()),[s,o]=i.exports.useState(ne.getSaveState());i.exports.useEffect(()=>ne.subscribe(()=>{t(ne.getConnections()),o(ne.getSaveState())}),[]);const a=i.exports.useCallback(function(l){ne.appendToSet(l)},[]),r=i.exports.useCallback(function(){const l=ne.toggleSave();o(l)},[]);return{connections:n,feed:a,toggleSave:r,save:s}}const A={Host:"host",SniffHost:"sniffHost",Network:"network",Process:"process",Type:"type",Chains:"chains",Rule:"rule",Speed:"speed",Upload:"upload",Download:"download",SourceIP:"sourceIP",DestinationIP:"destinationIP",Time:"time"},mn=new Set([A.Network,A.Type,A.Speed,A.Upload,A.Download,A.SourceIP,A.Time,A.Process]);function dn(n,t){switch(!0){case(n===0&&t===0):return"-";case(n!==0&&t!==0):return`\u2191 ${G(n)}/s \u2193 ${G(t)}/s`;case n!==0:return`\u2191 ${G(n)}/s`;default:return`\u2193 ${G(t)}/s`}}const z=dt().setRowType();function pn(){const{translation:n,lang:t}=O(),s=i.exports.useMemo(()=>n("Connections").t,[n]),o=X(),a=i.exports.useRef(null),{visible:r,show:l,hide:c}=Te();function m(){o.closeAllConnections().finally(()=>c())}const{connections:d,save:u,toggleSave:h}=at(),f=i.exports.useMemo(()=>d.map(p=>({id:p.id,host:`${p.metadata.host||p.metadata.destinationIP}:${p.metadata.destinationPort}`,sniffHost:p.metadata.sniffHost,chains:p.chains.slice().reverse().join(" / "),rule:p.rulePayload?`${p.rule} :: ${p.rulePayload}`:p.rule,time:new Date(p.start).getTime(),upload:p.upload,download:p.download,sourceIP:p.metadata.sourceIP,destinationIP:`${p.metadata.remoteDestination||p.metadata.destinationIP||p.metadata.host}`,type:p.metadata.type,network:p.metadata.network.toUpperCase(),process:p.metadata.processPath,speed:{upload:p.uploadSpeed,download:p.downloadSpeed},completed:!!p.completed,original:p})),[d]),g=i.exports.useMemo(()=>{const p=pt(d,"metadata.sourceIP");return Object.keys(p).map(T=>({label:T,number:p[T].length})).sort((T,P)=>T.label.localeCompare(P.label))},[d]),[E,w]=i.exports.useState(""),S=i.exports.useMemo(()=>{if(!E.trim())return f;const p=E.toLowerCase().trim();return f.filter(T=>{var P,C;return T.host.toLowerCase().includes(p)||((P=T.sniffHost)==null?void 0:P.toLowerCase().includes(p))||T.chains.toLowerCase().includes(p)||T.rule.toLowerCase().includes(p)||T.sourceIP.toLowerCase().includes(p)||((C=T.destinationIP)==null?void 0:C.toLowerCase().includes(p))})},[f,E]);function y(p){w(p)}const x=i.exports.useRef(null),N=ft(x,{threshold:[1]}),I=i.exports.useMemo(()=>z.createColumns([z.createDataColumn(A.Host,{minSize:220,size:220,header:s(`columns.${A.Host}`)}),z.createDataColumn(A.Rule,{minSize:220,size:220,header:s(`columns.${A.Rule}`)}),z.createDataColumn(A.Chains,{minSize:260,size:260,header:s(`columns.${A.Chains}`)}),z.createDataColumn(A.SourceIP,{minSize:140,size:140,header:s(`columns.${A.SourceIP}`),filterFn:"equals"}),z.createDataColumn(A.DestinationIP,{minSize:140,size:140,header:s(`columns.${A.DestinationIP}`)}),z.createDataColumn(p=>[p.speed.upload,p.speed.download],{id:A.Speed,header:s(`columns.${A.Speed}`),minSize:200,size:200,sortDescFirst:!0,sortingFn(p,T){var V,H,Q,Be;const P=(H=(V=p.original)==null?void 0:V.speed)!=null?H:{upload:0,download:0},C=(Be=(Q=T.original)==null?void 0:Q.speed)!=null?Be:{upload:0,download:0};return P.download===C.download?P.upload-C.upload:P.download-C.download},cell:p=>dn(p.value[0],p.value[1])}),z.createDataColumn(A.Upload,{minSize:100,size:100,header:s(`columns.${A.Upload}`),cell:p=>G(p.value)}),z.createDataColumn(A.Download,{minSize:100,size:100,header:s(`columns.${A.Download}`),cell:p=>G(p.value)}),z.createDataColumn(A.Time,{minSize:120,size:120,header:s(`columns.${A.Time}`),cell:p=>Ie(new Date(p.value),t),sortingFn:(p,T)=>{var P,C,V,H;return((C=(P=T.original)==null?void 0:P.time)!=null?C:0)-((H=(V=p.original)==null?void 0:V.time)!=null?H:0)}}),z.createDataColumn(A.Network,{minSize:80,size:80,header:s(`columns.${A.Network}`)}),z.createDataColumn(A.Type,{minSize:100,size:100,header:s(`columns.${A.Type}`)}),z.createDataColumn(A.Process,{minSize:100,size:100,header:s(`columns.${A.Process}`),cell:p=>p.value?Ge(p.value):"-"}),z.createDataColumn(A.SniffHost,{minSize:260,size:200,header:s(`columns.${A.SniffHost}`)})]),[t,s]),B=ht(z,{data:S,columns:I,getCoreRowModel:Et(),getSortedRowModel:yt(),getColumnFilteredRowModel:gt(),initialState:{sorting:[{id:A.Time,desc:!1}]},columnResizeMode:"onChange",enableColumnResizing:!0,autoResetSorting:!1,autoResetColumnFilters:!1}),b=B.getHeaderGroups()[0],[k,D]=i.exports.useState(""),R=i.exports.useMemo(()=>{const p={label:s("filter.all"),value:""},T=g.map(P=>({label:`${P.label} (${P.number})`,value:P.label}));return[p,...T]},[g,s]);function M(p){D(p),B.setColumnFilterValue(A.SourceIP,p||void 0)}const[v,F]=Re({visible:!1,selectedID:"",connection:{}});function U(){F(p=>{p.connection.completed=!0}),o.closeConnection(v.selectedID)}const W=Se(v.connection);i.exports.useEffect(()=>{var T;const p=(T=f.find(P=>P.id===v.selectedID))==null?void 0:T.original;p?F(P=>{P.connection={...p},v.selectedID===W.current.id&&(P.connection.completed=W.current.completed)}):Object.keys(W.current).length!==0&&!W.current.completed&&F(P=>{P.connection.completed=!0})},[f,v.selectedID,W,F]);const Z=i.exports.useMemo(()=>{var p;return((p=N==null?void 0:N.intersectionRatio)!=null?p:0)<1},[N]),q=b.headers.map((p,T)=>{const P=p.column,C=P.id;return e.createElement("th",{...p.getHeaderProps(V=>le(V,H=>{H.className=L("connections-th",{resizing:P.getIsResizing(),fixed:P.id===A.Host,shadow:Z&&P.id===A.Host}),!H.style&&(H.style={}),H.style.width=p.getSize()})),ref:P.id===A.Host?x:void 0,key:C},e.createElement("div",{...P.getToggleSortingProps()},p.renderHeader(),P.getIsSorted()!==!1?P.getIsSorted()==="desc"?" \u2193":" \u2191":null),T!==b.headers.length-1&&e.createElement("div",{...p.getResizerProps(),className:"connections-resizer"}))}),re=B.getRowModel().rows.map(p=>{var T;return e.createElement("tr",{...p.getRowProps(),className:"cursor-default select-none",key:(T=p.original)==null?void 0:T.id,onClick:()=>{var P;return F({visible:!0,selectedID:(P=p.original)==null?void 0:P.id})}},p.getAllCells().map(P=>{var V;const C=L("connections-block",{"text-center":mn.has(P.column.id),completed:(V=p.original)==null?void 0:V.completed},{fixed:P.column.id===A.Host,shadow:Z&&P.column.id===A.Host});return e.createElement("td",{...P.getCellProps(H=>le(H,Q=>{!Q.style&&(Q.style={}),Q.className=C,Q.style.width=P.column.getSize()})),key:P.column.id},P.renderCell())}))});return e.createElement("div",{className:"page"},e.createElement(te,{title:s("title")},g.length>1&&e.createElement(ge,{className:"connections-device-select",value:k,options:R,onSelect:M,maxHeight:440}),e.createElement(Fe,{className:"connections-search",value:E,placeholder:s("searchPlaceholder"),onSearch:y,onClear:()=>y(""),storageKey:"connections-search-history",minWidth:"200px"}),e.createElement(st,{className:"connections-filter",checked:u,onChange:h},s("keepClosed")),e.createElement("button",{className:"connections-close-all-btn",onClick:l,title:s("closeAll.title")},e.createElement("img",{src:ln,alt:"close all"}))),e.createElement(j,{ref:a,className:"connections-card relative md:mt-4"},e.createElement("div",{className:"overflow-auto min-h-full min-w-full"},e.createElement("table",{...B.getTableProps()},e.createElement("thead",null,e.createElement("tr",{...b.getHeaderGroupProps(),className:"connections-header"},q)),e.createElement("tbody",{...B.getTableBodyProps()},re)))),e.createElement(nt,{title:s("closeAll.title"),show:r,onClose:c,onOk:m},s("closeAll.content")),e.createElement(rn,{containerRef:a,bodyClassName:"flex flex-col bg-[#15222a] text-[#b7c5d6]",visible:v.visible,width:450},e.createElement("div",{className:"flex h-8 justify-between items-center"},e.createElement("span",{className:"font-bold pl-3"},s("info.title")),e.createElement(K,{type:"close",size:16,className:"cursor-pointer",onClick:()=>F("visible",!1)})),e.createElement(cn,{className:"mt-3 px-5",connection:v.connection}),e.createElement("div",{className:"flex mt-3 pr-3 justify-end"},e.createElement(xe,{type:"danger",disiabled:v.connection.completed,onClick:()=>U()},s("info.closeConnection")))))}function fn(){const{translation:n}=O(),{t}=n("Settings"),{hostname:s,port:o,secret:a}=ce(),[r,l]=J(De),[c,m]=Re({hostname:"",port:"",secret:""});i.exports.useEffect(()=>{m({hostname:s,port:o,secret:a})},[s,o,a,m]);const d=Pe(Ke);function u(){const{hostname:h,port:f,secret:g}=c;d([{hostname:h,port:f,secret:g}])}return e.createElement(nt,{show:!r,title:t("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>l(!0),onOk:u},e.createElement(nn,{type:"info",inside:!0},e.createElement("p",null,t("externalControllerSetting.note"))),e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.host")),e.createElement(Y,{className:"flex-1 my-1 md:my-3",align:"left",inside:!0,value:c.hostname,onChange:h=>m("hostname",h),onEnter:u})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.port")),e.createElement(Y,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:c.port,onChange:h=>m("port",h),onEnter:u})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.secret")),e.createElement(Y,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:c.secret,onChange:h=>m("secret",h),onEnter:u})))}const hn=[{label:"Default",value:""},{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warn",value:"warning"},{label:"Error",value:"error"},{label:"Silent",value:"silent"}],En=new Map([["debug","text-teal-500"],["info","text-sky-500"],["warning","text-pink-500"],["error","text-rose-500"]]);function ve(n){return/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(n)}function Me(n){return!n.includes(":")||n.includes("[")||n.includes("]")||/^\d{2}:\d{2}:\d{2}$/.test(n)||(n.match(/:/g)||[]).length<2||n.length<5||n.startsWith("::")&&n.length<10?!1:/^[0-9a-fA-F:]+$/.test(n)}function yn(n){const t=n.indexOf("-->");if(t===-1)return;const o=n.substring(0,t).replace(/\[\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2}\]/g,"").replace(/\[(TCP|UDP)\]/g,"").trim().split(/\s+/);for(let a=o.length-1;a>=0;a--){const r=o[a].trim();if(!r)continue;const l=r.match(/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):\d+$/);if(l)return l[1];if(ve(r))return r;const c=r.match(/^\[([0-9a-fA-F:]+)\]:\d+$/);if(c&&Me(c[1]))return c[1];const m=r.match(/^([0-9a-fA-F:]+)(?::\d+)?$/);if(m&&Me(m[1]))return m[1]}}function gn(){var I,B;const n=i.exports.useRef(null),t=i.exports.useRef([]),[s,o]=i.exports.useState([]),{translation:a}=O(),{data:{logLevel:r},set:l}=he(),{t:c}=a("Logs"),m=tt(),d=i.exports.useRef((B=(I=n.current)==null?void 0:I.scrollHeight)!=null?B:0),[u,h]=i.exports.useState(!1);i.exports.useEffect(()=>{!u&&t.current.length>0&&o(t.current)},[u]);const[f,g]=i.exports.useState(""),[E,w]=i.exports.useState(""),S=i.exports.useRef(new Map),y=i.exports.useMemo(()=>b=>{const k=S.current;if(k.has(b))return k.get(b);const D=yn(b),R=D?{sourceIP:D}:{};return k.set(b,R),R},[]),x=i.exports.useMemo(()=>{const b=new Set;s.forEach(R=>{if(!R.payload)return;const M=y(R.payload);M.sourceIP&&b.add(M.sourceIP)});const k=Array.from(b).sort((R,M)=>{const v=ve(R),F=ve(M);return v&&!F?-1:!v&&F?1:R.localeCompare(M)});return[{label:c("filter.all"),value:""},...k.map(R=>({label:R,value:R}))]},[s,y,c]),N=i.exports.useMemo(()=>!f&&!E.trim()?s:s.filter(b=>{if(!b.payload||f&&y(b.payload).sourceIP!==f)return!1;if(E.trim()){const k=E.toLowerCase().trim();if(!b.payload.toLowerCase().includes(k))return!1}return!0}),[s,f,E,y]);return i.exports.useLayoutEffect(()=>{var k;const b=n.current;b!=null&&b.scrollTop<=5&&(b.scrollTop=0),d.current=(k=b==null?void 0:b.scrollHeight)!=null?k:0},[N]),i.exports.useEffect(()=>{function b(k){const D=k.map(R=>({...R,time:R.time||new Date}));t.current=D.concat(t.current),!u&&o(t.current)}if(m!=null){m.subscribe("data",b);const k=m.buffer().map(D=>({...D,time:D.time||new Date}));t.current=k.slice().reverse(),o(t.current)}return()=>m==null?void 0:m.unsubscribe("data",b)},[m,u]),e.createElement("div",{className:"page"},e.createElement(te,{title:c("title")},e.createElement(ge,{className:"logs-level-select",options:hn,value:xt(r),onSelect:b=>l(k=>{k.logLevel=b}),maxHeight:300}),e.createElement(ge,{className:"logs-filter-select",options:x,value:f,onSelect:g,maxHeight:300}),e.createElement(Fe,{className:"logs-search-input",value:E,placeholder:c("searchPlaceholder"),onSearch:w,onClear:()=>w(""),storageKey:"logs-search-history",minWidth:"200px"}),e.createElement("button",{className:"logs-pause-btn",onClick:()=>h(!u)},u?"\u25B6":"\u23F8")),e.createElement(j,{className:"flex flex-col flex-1 mt-2.5 md:mt-4"},e.createElement("ul",{className:"logs-panel",ref:n},N.map((b,k)=>{const D=b.time||new Date,R=b.payload||"",M=b.type||"unknown",v=`${D.getTime()}-${R.substring(0,50)}-${k}`;return e.createElement("li",{className:"leading-5 inline-block",key:v},e.createElement("span",{className:"mr-2 text-orange-400"},"[",pe(D).format("YYYY-MM-DD HH:mm:ss"),"]"),e.createElement("span",{className:En.get(M)||""},"[",M.toUpperCase(),"]"),e.createElement("span",null," ",R))}))))}var we=(n=>(n.SPEED_NOTIFY="speed-notify",n))(we||{});class xn{constructor(){this.EE=new ze}notifySpeedTest(){this.EE.emit("speed-notify")}subscribe(t,s){this.EE.addListener(t,s)}unsubscribe(t,s){this.EE.removeListener(t,s)}}var Ce=new xn;function rt(n){const{config:t,className:s}=n,{set:o}=ie(),a=X(),{config:r}=fe(),l=i.exports.useCallback(async f=>{var E;if(ae())return(E=await($==null?void 0:$.getProxyDelay(f)))!=null?E:0;const{data:{delay:g}}=await a.getProxyDelay(f,r.speedtestUrl,r.speedtestTimeout);return g},[a,r]),c=i.exports.useCallback(async function(){const f=await We.fromPromise(l(t.name),E=>E),g=f.isErr()?0:f.value;o(E=>{const w=E.proxies.find(S=>S.name===t.name);w!=null&&w.history.push({time:new Date().toISOString(),delay:g})})},[t.name,l,o]),m=i.exports.useMemo(()=>{var f;return(f=t.history)!=null&&f.length?t.history.slice(-1)[0].delay:0},[t]);i.exports.useLayoutEffect(()=>{const f=()=>{c()};return Ce.subscribe(we.SPEED_NOTIFY,f),()=>Ce.unsubscribe(we.SPEED_NOTIFY,f)},[c]);const d=i.exports.useMemo(()=>m===0,[m]),u=i.exports.useMemo(()=>{if(!d)return m<r.lowLatency?"#57b366":m<r.mediumLatency?"#ff9a28":"#ff3e5e"},[m,d,r.lowLatency,r.mediumLatency]),h=d?void 0:u;return e.createElement("div",{className:L("proxy-item",{"proxy-error":d},s)},e.createElement("span",{className:"proxy-type",style:{backgroundColor:h}},t.type),e.createElement("p",{className:"proxy-name"},t.name),e.createElement("p",{className:"proxy-delay",style:{color:u}},m===0?"-":`${m}ms`),e.createElement("span",{className:"proxy-udp"},t.xudp.valueOf()?"XUDP":t.udp.valueOf()?"UDP":null))}function vn(n){const{update:t,markProxySelected:s}=ie(),[o]=J(Ze),{data:a}=he(),r=X(),{config:l}=fe(),{config:c}=n;async function m(h){const f=n.config.now;if(n.config.type==="URLTest"&&n.config.fixed===h?(await r.getGroupDelay(n.config.name,l.speedtestUrl,l.speedtestTimeout),await t()):(await r.changeProxySelected(n.config.name,h),s(n.config.name,h),n.config.type==="URLTest"&&await t()),a.breakConnections){const E=(await r.getProxy(n.config.name)).data.now;if(f!==E){const w=[],S=await r.getConnections();for(const y of S.data.connections)y.chains.includes(n.config.name)&&w.push(y.id);await Promise.all(w.map(y=>r.closeConnection(y)))}}}const d=i.exports.useMemo(()=>{var f;const h=new Set;for(const g of c.all){const E=(f=o.get(g))==null?void 0:f.history;(E==null?void 0:E.length)&&E.slice(-1)[0].delay===0&&h.add(g)}return h},[c.all,o]),u=c.type==="Selector"||c.type==="URLTest";return e.createElement("div",{className:"proxy-group"},e.createElement("div",{className:"flex h-10 mt-4 w-full items-center justify-between md:h-15 md:mt-0 md:w-auto "},e.createElement("span",{className:"h-6 px-2.5 md:px-5 w-35 overflow-hidden overflow-ellipsis whitespace-nowrap md:w-30"},c.name),e.createElement(oe,{className:"mr-2.5 md:mr-0"},c.type)),e.createElement("div",{className:"flex-1 py-2 md:py-4"},e.createElement(_t,{className:"ml-2.5 md:ml-8",data:c.all,onClick:m,errSet:d,select:c.now,canClick:u,rowHeight:30,group:c,fixed:c.fixed})))}function wn(n){const{subscriptionInfo:t,className:s,style:o}=n,a=L("progress",s),r={...o},l={...n,className:a,style:r},c=t?Ue((t==null?void 0:t.Download)+(t==null?void 0:t.Upload)):0,m=t?Ue(t.Total):0,d=t?((t.Download+t.Upload)/t.Total*100).toFixed(2):0;return e.createElement("div",{...l},e.createElement("div",{className:"progress-info"},c," / ",m," (",d.toString()+"%",")"),e.createElement("div",{className:"progress-fill",style:{width:d.toString()+"%"}}))}function Ue(n,t=2){if(n){const o=t<0?0:t,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(n)/Math.log(1024));return`${parseFloat((n/Math.pow(1024,r)).toFixed(o))} ${a[r]}`}else return"0 Bytes"}function Cn(n){const{update:t}=Le(),{translation:s,lang:o}=O(),a=X(),{provider:r}=n,{t:l}=s("Proxies"),{visible:c,hide:m,show:d}=Te();function u(){d(),a.healthCheckProvider(r.name).then(async()=>await t()).finally(()=>m())}const h=i.exports.useMemo(()=>{var x;if(!((x=r.subscriptionInfo)!=null&&x.Expire))return;const E=new Date(r.subscriptionInfo.Expire*1e3),w=E.getFullYear().toString()+"-",S=(E.getMonth()+1<10?"0"+(E.getMonth()+1).toString():E.getMonth()+1).toString()+"-",y=E.getDate().toString()+" ";return w+S+y},[r.subscriptionInfo]);function f(){d(),a.updateProvider(r.name).then(async()=>await t()).finally(()=>m())}const g=i.exports.useMemo(()=>r.proxies.slice().sort((E,w)=>-1*be(E,w)),[r.proxies]);return e.createElement(j,{className:"proxy-provider"},e.createElement(ot,{visible:c}),e.createElement("div",{className:"flex flex-col justify-between md:flex-row md:items-center"},e.createElement("div",{className:"flex items-center flex-wrap gap-4"},e.createElement("span",{className:"mr-2"},r.name),e.createElement(oe,null,r.vehicleType),e.createElement(oe,{className:"rule-provider-behavior m-0"},r.proxies.length),h&&e.createElement(oe,{className:"rule-provider-expire m-0"},"Expire: ",h),r.subscriptionInfo&&e.createElement(wn,{subscriptionInfo:r.subscriptionInfo})),e.createElement("div",{className:"flex pt-3 items-center md:pt-0 flex-none"},r.updatedAt&&e.createElement("span",{className:"text-sm"},`${l("providerUpdateTime")}: ${Ie(new Date(r.updatedAt),o)}`),e.createElement(K,{className:"cursor-pointer text-red pl-5",type:"healthcheck",size:18,onClick:u}),e.createElement(K,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:f}))),e.createElement("ul",{className:"proxies-list"},g.map(E=>e.createElement("li",{key:E.name},e.createElement(rt,{className:"proxy-provider-item",config:E})))))}const bn={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function be(n,t){const s=n.history.length>0?n.history.slice(-1)[0].delay:0;return((t.history.length>0?t.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(s||Number.MAX_SAFE_INTEGER)}function Nn(){const{groups:n,global:t}=ie(),{data:s,set:o}=he(),{general:a}=ke(),{translation:r}=O(),{t:l}=r("Proxies"),c=i.exports.useMemo(()=>a.mode==="global"?[t,...n]:n,[a,n,t]);return e.createElement(e.Fragment,null,c.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(te,{title:l("groupTitle")},e.createElement(st,{className:"cursor-pointer text-sm text-shadow-primary text-[#619cc2] h-[30px] flex items-center",checked:s.breakConnections,onChange:m=>o("breakConnections",m)},l("breakConnectionsText"))),e.createElement(j,{className:"my-2.5 p-0 md:mt-4"},e.createElement("ul",{className:"list-none divide-y divide-gray-300"},c.map(m=>e.createElement("li",{key:m.name},e.createElement(vn,{config:m})))))))}function Pn(){const{providers:n}=Le(),{translation:t}=O(),{t:s}=t("Proxies");return e.createElement(e.Fragment,null,n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(te,{title:s("providerTitle")}),e.createElement("ul",{className:"list-none"},n.map(o=>e.createElement("li",{className:"my-2.5 md:my-4",key:o.name},e.createElement(Cn,{provider:o}))))))}function Sn(){const{proxies:n}=ie(),{translation:t}=O(),{t:s}=t("Proxies");function o(){Ce.notifySpeedTest()}const{current:a,next:r}=sn([1,2,0]),l=i.exports.useMemo(()=>{switch(a){case 2:return n.slice().sort((m,d)=>be(m,d));case 1:return n.slice().sort((m,d)=>-1*be(m,d));default:return n.slice()}},[a,n]),c=r;return e.createElement(e.Fragment,null,l.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(te,{title:s("title")},e.createElement(K,{className:"ml-3",type:bn[a],onClick:c,size:20}),e.createElement(K,{className:"ml-3",type:"speed",size:20}),e.createElement("span",{className:"proxies-speed-test text-[#619cc2]",onClick:o},s("speedTestText"))),e.createElement(j,{className:"proxy-provider md:mt-4"},e.createElement("ul",{className:"proxies-list"},l.map(m=>e.createElement("li",{key:m.name},e.createElement(rt,{config:m})))))))}function An(){return e.createElement("div",{className:"page"},e.createElement(Nn,null),e.createElement(Pn,null),e.createElement(Sn,null))}function Dn(n){const{update:t}=qe(),{translation:s,lang:o}=O(),a=X(),{provider:r}=n,{t:l}=s("Rules"),{visible:c,hide:m,show:d}=Te();function u(){d(),a.updateRuleProvider(r.name).then(async()=>await t()).finally(()=>m())}const h=L("rule-provider-icon",{"rule-provider-loading":c});return e.createElement("div",{className:"rule-provider"},e.createElement("div",{className:"rule-provider-header"},e.createElement("div",{className:"rule-provider-header-part"},e.createElement("span",{className:"rule-provider-name"},r.name),e.createElement(oe,null,r.vehicleType),e.createElement(oe,{className:"rule-provider-behavior"},r.behavior),e.createElement("span",{className:"rule-provider-update"},`${l("ruleCount")}: ${r.ruleCount}`)),e.createElement("div",{className:"rule-provider-header-part"},r.updatedAt&&e.createElement("span",{className:"rule-provider-update"},`${l("providerUpdateTime")}: ${Ie(new Date(r.updatedAt),o)}`),e.createElement(K,{className:h,type:"update",size:18,onClick:u}))))}function Ln(){const{providers:n}=qe(),{translation:t}=O(),{t:s}=t("Rules");return e.createElement(e.Fragment,null,n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(te,{title:s("providerTitle")}),e.createElement(j,{className:"divide-y rounded shadow-primary mt-4 p-0"},n.map(o=>e.createElement(Dn,{key:o.name,provider:o})))))}function kn(){const{rules:n,update:t}=jt(),{translation:s}=O(),{t:o}=s("Rules");se("rules",t);const[a,r]=i.exports.useState(""),l=i.exports.useMemo(()=>{if(!a.trim())return n;const d=a.toLowerCase().trim();return n.filter(u=>{var h,f,g;return((h=u.type)==null?void 0:h.toLowerCase().includes(d))||((f=u.payload)==null?void 0:f.toLowerCase().includes(d))||((g=u.proxy)==null?void 0:g.toLowerCase().includes(d))})},[n,a]);function c(d){r(d)}function m({index:d,style:u}){const h=l[d],f=h.size||-1;return e.createElement("li",{className:"rule-item",style:u},e.createElement("div",{className:"flex py-1"},e.createElement("div",{className:"text-center w-40 rule-type"},h.type),e.createElement("div",{className:"flex-1 text-center payload"}," ",f!==-1?`${h.payload} :: ${f}`:h.payload),e.createElement("div",{className:"text-center w-40 rule-proxy"},h.proxy)))}return e.createElement("div",{className:"page"},e.createElement(Ln,null),e.createElement(te,{className:"not-first:mt-7.5",title:o("title")},e.createElement(Fe,{className:"rules-search",value:a,placeholder:o("searchPlaceholder"),onSearch:c,onClear:()=>c(""),storageKey:"rules-search-history",minWidth:"200px"})),e.createElement(j,{className:"flex flex-col flex-1 mt-2.5 p-0 md:mt-4 focus:outline-none text-sm"},e.createElement(vt,{className:"min-h-120"},({height:d,width:u})=>e.createElement(wt,{height:d,width:u,itemCount:l.length,itemSize:40},m))))}const Fn=[{label:"\u4E2D\u6587",value:"zh_CN"},{label:"English",value:"en_US"}];function Rn(){var p,T,P;const{premium:n}=Xe(),{data:t,update:s}=et(),{general:o,update:a}=ke(),r=Pe(De),l=ce(),{translation:c,setLang:m,lang:d}=O(),{t:u}=c("Settings"),h=X(),{config:f,setConfig:g}=fe(),[E,w]=Re({mixedProxyPort:0,socks5ProxyPort:7891,httpProxyPort:7890,redirProxyPort:7892}),S=i.exports.useCallback(C=>{g({...f,...C})},[f,g]);i.exports.useEffect(()=>{var C,V,H,Q;w("socks5ProxyPort",(C=o==null?void 0:o.socksPort)!=null?C:0),w("httpProxyPort",(V=o==null?void 0:o.port)!=null?V:0),w("mixedProxyPort",(H=o==null?void 0:o.mixedPort)!=null?H:0),w("redirProxyPort",(Q=o==null?void 0:o.redirPort)!=null?Q:0)},[o,w]);async function y(C){await h.updateConfig({mode:C}),await a()}async function x(C){await($==null?void 0:$.setStartAtLogin(C)),await s()}async function N(C){await($==null?void 0:$.setSystemProxy(C)),await s()}function I(C){m(C)}async function B(){await h.updateConfig({port:E.httpProxyPort}),await a()}async function b(){await h.updateConfig({"socks-port":E.socks5ProxyPort}),await a()}async function k(){await h.updateConfig({"mixed-port":E.mixedProxyPort}),await a()}async function D(){await h.updateConfig({"redir-port":E.redirProxyPort}),await a()}async function R(C){await h.updateConfig({"allow-lan":C}),await a()}const{hostname:M,port:v}=l,{allowLan:F,mode:U}=o,W=(p=t==null?void 0:t.startAtLogin)!=null?p:!1,Z=(T=t==null?void 0:t.systemProxy)!=null?T:!1,q=(P=t==null?void 0:t.isClashX)!=null?P:!1,re=i.exports.useMemo(()=>{const C=[{label:u("values.global"),value:"Global"},{label:u("values.rules"),value:"Rule"},{label:u("values.direct"),value:"Direct"}];return n&&C.push({label:u("values.script"),value:"Script"}),C},[u,n]);return e.createElement("div",{className:"page"},e.createElement(te,{title:u("title")}),e.createElement(j,{className:"settings-card md:my-4"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},u("labels.language")),e.createElement($e,{options:Fn,value:d,onSelect:C=>I(C)})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},u("labels.allowConnectFromLan")),e.createElement(ye,{checked:F,onChange:R}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},u("labels.proxyMode")),e.createElement($e,{options:re,value:Ct(U),onSelect:y})))),q&&e.createElement(j,{className:"settings-card md:my-4"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.startAtLogin")),e.createElement(ye,{checked:W,onChange:x})),e.createElement("div",{className:"flex w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.setAsSystemProxy")),e.createElement(ye,{checked:Z,onChange:N})))),e.createElement(j,{className:"settings-card md:my-4"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.mixedProxyPort")),e.createElement(Y,{className:"w-28",disabled:q,value:E.mixedProxyPort,onChange:C=>w("mixedProxyPort",+C),onBlur:k})),e.createElement("div",{className:"flex  w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.redirProxyPort")),e.createElement(Y,{className:"w-28",disabled:q,value:E.redirProxyPort,onChange:C=>w("redirProxyPort",+C),onBlur:D}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.socks5ProxyPort")),e.createElement(Y,{className:"w-28",disabled:q,value:E.socks5ProxyPort,onChange:C=>w("socks5ProxyPort",+C),onBlur:b})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.httpProxyPort")),e.createElement(Y,{className:"w-28",disabled:q,value:E.httpProxyPort,onChange:C=>w("httpProxyPort",+C),onBlur:B})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.externalController")),e.createElement("span",{className:L({"modify-btn":!q},"external-controller"),onClick:()=>!q&&r(!1)},`${M}:${v}`)))),e.createElement(j,{className:"settings-card md:my-4"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.speedtestUrl")),e.createElement(Y,{className:"flex-1 max-w-xs settings-speedtest-input",value:f.speedtestUrl,onChange:C=>S({speedtestUrl:C}),placeholder:u("labels.speedtestUrl")})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.speedtestTimeout")),e.createElement("div",{className:"flex items-center gap-2"},e.createElement(Y,{className:"w-28",type:"number",value:f.speedtestTimeout,onChange:C=>S({speedtestTimeout:Number(C)||5e3})}),e.createElement("span",{className:"text-sm text-white"},"ms"))),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.lowLatency")),e.createElement("div",{className:"flex items-center gap-2"},e.createElement(Y,{className:"w-28",type:"number",value:f.lowLatency,onChange:C=>S({lowLatency:Number(C)||400})}),e.createElement("span",{className:"text-sm text-white"},"ms"))),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-3 md:px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},u("labels.mediumLatency")),e.createElement("div",{className:"flex items-center gap-2"},e.createElement(Y,{className:"w-28",type:"number",value:f.mediumLatency,onChange:C=>S({mediumLatency:Number(C)||800})}),e.createElement("span",{className:"text-sm text-white"},"ms"))))))}var Tn="./assets/logo.0dc1c7df.png",In="./assets/icon-upload.81479c61.svg",Bn="./assets/icon-download.51093bf5.svg",$n="./assets/icon-memory.93b6e61f.svg",Mn="./assets/icon-connection.a2fe5564.svg";function Un(n){const{routes:t}=n,{translation:s}=O(),{version:o,premium:a,meta:r}=Xe(),{data:l}=et(),{t:c}=s("SideBar"),m=Ne(),d=Xt(),{connections:u,feed:h}=at(),[f,g]=i.exports.useState({uploadTotal:0,downloadTotal:0,memory:0,connectionCount:0}),E=i.exports.useMemo(()=>{const S=u.filter(x=>!x.completed).reduce((x,N)=>x+(N.uploadSpeed||0),0),y=u.filter(x=>!x.completed).reduce((x,N)=>x+(N.downloadSpeed||0),0);return{uploadSpeed:S,downloadSpeed:y}},[u]);i.exports.useLayoutEffect(()=>{function S(y){for(const x of y)g({uploadTotal:x.uploadTotal,downloadTotal:x.downloadTotal,memory:x.memory,connectionCount:x.connections.length}),h(x.connections)}return d==null||d.subscribe("data",S),()=>{d==null||d.unsubscribe("data",S)}},[d,h]);const w=t.map(({path:S,name:y,noMobile:x})=>e.createElement("li",{className:L("item",{"no-mobile":x}),key:y},e.createElement(bt,{to:{pathname:S,search:m.search},className:({isActive:N})=>L({active:N})},c(y))));return e.createElement("div",{className:"sidebar"},e.createElement("img",{src:Tn,alt:"logo",className:"sidebar-logo"}),e.createElement("ul",{className:"sidebar-menu"},w),e.createElement("div",{className:"sidebar-stats"},e.createElement("div",{className:"sidebar-stats-group"},e.createElement("div",{className:"sidebar-stats-item"},e.createElement("img",{src:In,alt:"upload",className:"sidebar-stats-icon"}),e.createElement("span",{className:"sidebar-stats-value"},G(f.uploadTotal))),e.createElement("div",{className:"sidebar-stats-speed"},e.createElement("span",{className:"sidebar-stats-speed-value"},E.uploadSpeed>0?`\u2191 ${G(E.uploadSpeed)}/s`:"-"))),e.createElement("div",{className:"sidebar-stats-group"},e.createElement("div",{className:"sidebar-stats-item"},e.createElement("img",{src:Bn,alt:"download",className:"sidebar-stats-icon"}),e.createElement("span",{className:"sidebar-stats-value"},G(f.downloadTotal))),e.createElement("div",{className:"sidebar-stats-speed"},e.createElement("span",{className:"sidebar-stats-speed-value"},E.downloadSpeed>0?`\u2193 ${G(E.downloadSpeed)}/s`:"-"))),e.createElement("div",{className:"sidebar-stats-item"},e.createElement("img",{src:Mn,alt:"connection",className:"sidebar-stats-icon"}),e.createElement("span",{className:"sidebar-stats-value"},f.connectionCount)),e.createElement("div",{className:"sidebar-stats-item"},e.createElement("img",{src:$n,alt:"memory",className:"sidebar-stats-icon"}),e.createElement("span",{className:"sidebar-stats-value"},G(f.memory)))),e.createElement("div",{className:"sidebar-version"},e.createElement("span",{className:"sidebar-version-label"},"Clash",(l==null?void 0:l.isClashX)&&"X"," ",c("Version")),e.createElement("span",{className:"sidebar-version-text"},o),a&&e.createElement("span",{className:"sidebar-version-label"},"Premium"),r&&e.createElement("span",{className:"sidebar-version-label"},"Meta")))}function Hn(){tt();const n=Ne(),t=on(),{update:s}=ie(),{update:o}=Le(),a=i.exports.useRef();i.exports.useEffect(()=>{a.current!==void 0&&a.current!=="visible"&&t==="visible"&&(s(),o()),a.current=t},[t,s,o]);const r=[{path:"/proxies",name:"Proxies",element:e.createElement(An,null)},{path:"/logs",name:"Logs",element:e.createElement(gn,null)},{path:"/connections",name:"Connections",element:e.createElement(pn,null),noMobile:!1},{path:"/rules",name:"Rules",element:e.createElement(kn,null),noMobile:!1},{path:"/settings",name:"Settings",element:e.createElement(Rn,null)}],l=e.createElement("div",{className:L("app",{"not-clashx":!ae()})},e.createElement(Un,{routes:r}),e.createElement("div",{className:"page-container"},e.createElement(Nt,null)),e.createElement(fn,null));return e.createElement(Pt,null,e.createElement(Ee,{path:"/",element:l},e.createElement(Ee,{path:"/",element:e.createElement(St,{to:{pathname:"/proxies",search:n.search},replace:!0})}),r.map(c=>e.createElement(Ee,{path:c.path,key:c.path,element:c.element}))))}function He(){const n=document.getElementById("root"),t=e.createElement(i.exports.StrictMode,null,e.createElement(Dt,null,e.createElement(i.exports.Suspense,{fallback:e.createElement(ot,{visible:!0})},e.createElement(Hn,null))));At(n).render(t)}ae()?Ft(()=>He()):He();
